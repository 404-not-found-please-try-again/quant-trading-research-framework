# 模拟盘交易系统使用说明

## 📋 概述

模拟盘交易系统用于在实盘前进行真实市场环境的测试，验证模型的实时性能和系统稳定性。

## 🚀 快速开始

### 1. 准备工作

确保已经完成模型训练：

```bash
python main.py
```

这将生成训练好的模型文件，保存在 `results/models/` 目录下。

### 2. 运行模拟盘

#### 方式 1：每日运行模式（推荐）

```bash
python paper_trading_main.py --mode daily
```

这个模式会：

- 获取最新市场数据
- 生成交易信号
- 执行模拟交易
- 保存每日报告

#### 方式 2：模拟运行模式（测试用）

```bash
python paper_trading_main.py --mode simulation --days 30
```

这个模式会连续运行 30 天的模拟交易（用于快速测试）。

## 📊 功能特性

### 1. 实时数据获取

- 从 Yahoo Finance 获取最新股票数据
- 自动处理数据缺失和异常
- 支持历史数据回填（用于特征计算）

### 2. 信号生成

- 使用集成模型（XGBoost + Random Forest）
- 应用动态阈值和置信度滤波
- 生成买入/卖出信号

### 3. 交易执行

- 模拟真实交易环境
- 考虑交易成本（佣金 0.1% + 滑点 0.05%）
- 仓位管理（最大单笔仓位 10%）
- 状态持久化（支持系统重启恢复）

### 4. 监控和报告

- 实时投资组合价值计算
- 每日报告生成
- 交易历史记录
- 盈亏统计

## 📁 文件结构

```
results/paper_trading/
├── paper_trading_state.json      # 交易状态（持仓、现金等）
├── daily_report_YYYYMMDD.json    # 每日报告
├── trade_history.csv             # 交易历史
└── portfolio_history.csv         # 投资组合历史
```

## 📈 监控指标

### 每日报告包含：

- **现金余额**: 当前可用现金
- **总价值**: 现金 + 持仓市值
- **总收益率**: (总价值 - 初始资金) / 初始资金
- **持仓详情**: 每只股票的持仓数量、平均成本、当前价格、盈亏
- **交易次数**: 累计交易次数

### 关键指标：

- **Sharpe 比率**: 风险调整后收益
- **最大回撤**: 最大亏损幅度
- **胜率**: 盈利交易占比
- **平均持仓时间**: 持仓平均天数

## ⚙️ 配置说明

模拟盘使用 `config/config.yaml` 中的配置：

```yaml
backtesting:
  initial_capital: 100000 # 初始资金
  commission: 0.001 # 佣金0.1%
  slippage: 0.0005 # 滑点0.05%
  max_position_size: 0.1 # 最大单笔仓位10%
```

## 🔄 定时运行

### Windows 任务计划程序

1. 打开"任务计划程序"
2. 创建基本任务
3. 触发器：每个交易日（周一至周五）
4. 操作：运行 `python paper_trading_main.py --mode daily`
5. 起始时间：市场开盘前（如 9:00 AM）

### Linux Cron

添加到 crontab：

```bash
# 每个交易日9:00 AM运行
0 9 * * 1-5 cd /path/to/project && python paper_trading_main.py --mode daily
```

## 📊 查看结果

### 1. 查看每日报告

```bash
# 查看最新报告
cat results/paper_trading/daily_report_$(date +%Y%m%d).json
```

### 2. 查看交易历史

```bash
# 查看CSV格式的交易历史
cat results/paper_trading/trade_history.csv
```

### 3. 查看投资组合状态

```bash
# 查看当前状态
cat results/paper_trading/paper_trading_state.json
```

## ⚠️ 注意事项

### 1. 数据延迟

- Yahoo Finance 数据可能有 15-20 分钟延迟
- 建议在收盘后运行，使用当日收盘价

### 2. 交易日历

- 系统不会自动跳过节假日
- 需要手动处理非交易日

### 3. 模型更新

- 如果重新训练了模型，需要更新模型路径
- 建议定期重新训练模型（如每月）

### 4. 状态恢复

- 系统支持状态持久化
- 重启后会自动恢复持仓和现金余额

## 🐛 故障排除

### 问题 1：数据获取失败

**症状**: 无法获取股票数据
**解决**:

- 检查网络连接
- 确认 Yahoo Finance 可访问
- 检查股票代码是否正确

### 问题 2：模型加载失败

**症状**: 无法加载模型文件
**解决**:

- 确认已运行 `python main.py` 训练模型
- 检查 `results/models/` 目录下是否有模型文件
- 检查模型文件路径是否正确

### 问题 3：特征不匹配

**症状**: 特征数量或名称不匹配
**解决**:

- 重新运行特征工程
- 检查 `selected_features_latest.txt` 文件
- 确认特征工程代码未更改

## 📞 支持

如遇到问题，请检查：

1. 日志文件: `logs/paper_trading.log`
2. 错误信息
3. 配置文件是否正确

## 🎯 下一步

1. **运行 1-2 个月模拟盘**: 验证系统稳定性
2. **对比回测结果**: 模拟盘收益应与回测收益接近
3. **监控关键指标**: Sharpe、最大回撤、胜率
4. **优化参数**: 根据模拟盘结果调整参数
5. **准备实盘**: 模拟盘表现稳定后考虑实盘

---

**最后更新**: 2025-11-03




