# 美股预测系统配置文件

# 数据配置
data:
  # 股票代码列表
  symbols:
    - "QQQ" # Invesco QQQ Trust (纳斯达克100指数ETF)
    - "VOO" # Vanguard S&P 500 ETF (标普500指数ETF)

  # 时间范围
  start_date: "2020-01-01"
  end_date: "2024-12-31"

  # 数据存储路径
  data_path: "data/"

  # 数据更新频率
  update_frequency: "daily"

# 特征工程配置
features:
  # 技术指标参数
  technical_indicators:
    sma_periods: [5, 10, 20, 30, 50, 60, 100, 200] # 简单移动平均 - 增加中长期
    ema_periods: [5, 10, 20, 30, 50, 60] # 指数移动平均 - 增加中长期
    rsi_period: 14 # RSI周期
    macd_fast: 12 # MACD快线
    macd_slow: 26 # MACD慢线
    macd_signal: 9 # MACD信号线
    bollinger_period: 20 # 布林带周期
    bollinger_std: 2 # 布林带标准差
    atr_period: 14 # ATR周期

    # 新增中长期指标
    long_term_indicators:
      sma_periods: [30, 60, 90, 120] # 长期均线
      ema_periods: [30, 60, 90] # 长期指数均线
      momentum_periods: [20, 30, 60] # 动量指标周期
      volatility_periods: [20, 30, 60] # 波动率指标周期
      volume_periods: [20, 30, 60] # 成交量指标周期

  # 价格特征
  price_features:
    - "open"
    - "high"
    - "low"
    - "close"
    - "volume"
    - "adj_close"

  # 时间特征
  time_features:
    - "day_of_week"
    - "month"
    - "quarter"
    - "is_month_end"
    - "is_quarter_end"

  # 交互特征配置（优先级1：增强特征区分能力）
  interaction_features:
    enable: true # 是否启用交互特征
    # 技术指标与成交量的交互
    tech_volume_interactions: true
    # 技术指标之间的交互
    tech_tech_interactions: true
    # 价格变化与成交量的交互
    price_volume_interactions: true
    # 波动率与动量的交互
    volatility_momentum_interactions: true
    # 最大交互特征数量（避免特征爆炸）
    max_interactions: 50

# 标签配置
labels:
  # 预测目标
  target: "next_3day_return" # 3天平均收益率

  # 分类阈值
  classification_thresholds:
    up_threshold: 0.005 # 上涨阈值 (0.5%) - 降低阈值以缓解微小波动噪声，增加正类样本
    down_threshold: -0.005 # 下跌阈值 (-0.5%)
    neutral_threshold: 0.002 # 中性区间阈值 (0.2%)

  # 预测时间窗口
  prediction_windows: [3, 5, 10] # 3天、5天、10天 - 更长的预测窗口

  # 分类类型
  classification_type: "binary" # "binary" 或 "ternary"

  # 标签平滑参数
  smoothing:
    enable: true
    window: 3 # 使用3天移动平均平滑标签
    min_samples: 2 # 最少需要2个有效样本

# 模型配置
models:
  # XGBoost参数
  xgboost:
    n_estimators: 200
    max_depth: 5 # 提高到5（用户建议）
    learning_rate: 0.05 # eta=0.05（用户建议）
    subsample: 0.8
    colsample_bytree: 0.8
    reg_alpha: 0.1
    reg_lambda: 1.0
    random_state: 42
    # 类别平衡参数
    scale_pos_weight: "auto" # 自动计算正负样本比例，后续会乘以倍数增强
    scale_pos_weight_multiplier: 2.0 # 将权重乘以2倍以更强烈平衡类别
    eval_metric: "aucpr" # 改用AUC用于early stopping（用户建议）
    # 高级类别平衡
    class_balance:
      method: "smote" # 改用SMOTE过采样（优先级1）
      use_smote: true # 启用SMOTE
      force_smote: true # 强制应用SMOTE（即使不平衡比不高）
      smote_ratio: 0.75 # SMOTE过采样比例（0.75表示将正类样本增加到负类的75%，进一步平衡）（优化5）
      min_imbalance_ratio: 1.3 # 最小不平衡比阈值（低于此值不应用SMOTE）
      alpha: 0.25 # focal loss alpha（备用）
      gamma: 2.0 # focal loss gamma（备用）
      use_scale_pos_weight: true

  # RandomForest参数
  random_forest:
    n_estimators: 50
    max_depth: 6
    min_samples_split: 10
    min_samples_leaf: 5
    max_features: "sqrt"
    random_state: 42
    # 类别平衡参数
    class_weight: "balanced" # 自动平衡类别权重
    # 高级类别平衡
    class_balance:
      method: "balanced_subsample" # "balanced", "balanced_subsample", "custom"
      custom_weights: null # 自定义权重 {0: 1.0, 1: 2.0}
      use_smote: true # 启用SMOTE过采样（优先级1）
      force_smote: true # 强制应用SMOTE（即使不平衡比不高）
      smote_ratio: 0.75 # SMOTE过采样比例（提高到0.75进一步平衡）（优化5）
      min_imbalance_ratio: 1.3 # 最小不平衡比阈值（低于此值不应用SMOTE）

  # LSTM参数 - 优化版本（阶段2优化 + 优化4）
  lstm:
    sequence_length: 90 # 延长序列长度到90（优化4：提升趋势捕捉能力）
    hidden_units: 128 # 增加隐藏单元
    dropout_rate: 0.3 # 增加dropout防止过拟合
    learning_rate: 0.0001 # 使用AdamW，lr=1e-4
    batch_size: 64 # 增加batch size
    epochs: 150 # 增加训练轮数
    use_weighted_loss: true # 使用类别平衡的loss（BCEWithLogitsLoss + pos_weight）

# 训练配置
training:
  # 数据分割
  train_ratio: 0.7
  val_ratio: 0.15
  test_ratio: 0.15

  # 交叉验证
  cv_folds: 5

  # 时间序列分割
  time_series_split: true

# 回测配置
backtesting:
  # 初始资金
  initial_capital: 100000

  # 交易成本
  commission: 0.001 # 0.1%

  # 滑点
  slippage: 0.0005 # 0.05%

  # 风险管理
  max_position_size: 0.1 # 最大仓位10%
  stop_loss: 0.05 # 止损5%
  take_profit: 0.1 # 止盈10%

  # 信号生成策略（优化1和2）
  signal_strategy:
    # 动态阈值策略（优化1：精细分层）
    dynamic_threshold:
      enable: true # 启用动态阈值
      base_threshold: 0.55 # 基础阈值0.55（提高精确率）
      # 优化1：引入多层级置信度区间
      confidence_tiers:
        - range: [0.60, 1.00] # 高置信度区间
          weight: 1.0 # 全权重
          threshold_multiplier: 1.0 # 阈值倍数
        - range: [0.55, 0.60] # 中高置信度区间
          weight: 0.8 # 80%权重
          threshold_multiplier: 1.0
        - range: [0.45, 0.55] # 低置信度区间（原low_prob_range）
          weight: 0.3 # 30%权重（原low_prob_weight）
          threshold_multiplier: 0.9 # 降低阈值要求
        - range: [0.00, 0.45] # 极低置信度区间
          weight: 0.1 # 10%权重
          threshold_multiplier: 0.8 # 进一步降低阈值要求
      # 向后兼容参数
      low_prob_range: [0.45, 0.55] # 低置信度区间（保留用于兼容）
      low_prob_weight: 0.3 # 低置信度区间权重（保留用于兼容）

    # 置信度滤波（优化1：分层置信度阈值策略）
    confidence_filter:
      enable: true # 启用置信度滤波
      # 通用参数（用于RF和Ensemble）
      top_percentile: 0.35 # 进一步放宽到top 35%置信度样本（从30%提升，预期信号数量增加）
      min_confidence: 0.45 # 进一步降低最小置信度阈值（从0.50降到0.45，缓解LSTM信号稀疏问题）
      # 模型专用阈值（优化1：根据模型表现分层调整）
      model_specific_thresholds:
        xgboost:
          top_percentile: 0.30 # XGBoost表现最好，使用更严格的阈值（30%）
          min_confidence: 0.50 # 提高最小置信度阈值，提升信号质量
        random_forest:
          top_percentile: 0.35 # RF使用通用阈值
          min_confidence: 0.45
        lstm:
          top_percentile: 0.40 # LSTM表现不佳，使用更宽松的阈值（40%）
          min_confidence: 0.40 # LSTM专用阈值（由于LSTM信号过少，使用更宽松的阈值）

  # 加权集成策略（优化3：移除LSTM，仅使用XGBoost和Random Forest）
  ensemble:
    enable: true # 启用加权集成
    weights:
      xgboost: 0.55 # XGBoost权重（收益7.32%，Sharpe 2.511，表现稳定）
      random_forest: 0.45 # Random Forest权重（收益7.78%，Sharpe 2.803，表现最好）
      lstm: 0.0 # LSTM权重设为0（收益0.16%，表现极差，已移除）

# 风险管理配置
risk_management:
  # 仓位管理
  max_position_size: 0.1 # 最大单笔仓位10%
  max_total_exposure: 0.5 # 最大总敞口50%

  # 止损止盈
  stop_loss: 0.05 # 止损5%
  take_profit: 0.1 # 止盈10%
  trailing_stop: 0.03 # 跟踪止损3%

  # 风险控制
  max_drawdown: 0.15 # 最大回撤15%
  volatility_threshold: 0.3 # 波动率阈值30%

  # 风险指标
  var_confidence: 0.05 # VaR置信水平5%
  max_var: 0.02 # 最大VaR 2%

# 可视化配置
visualization:
  # 图表样式
  style: "seaborn-v0_8"

  # 图表大小
  figure_size: [12, 8]

  # 颜色主题
  color_palette: "Set2"

  # 保存路径
  save_path: "results/plots/"

# 日志配置
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/prediction.log"
